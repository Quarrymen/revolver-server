<!doctype html>
<html>
<head>
<title><%= title %></title>
<style>
  a{text-decoration: none;color:white;}
</style>
<!--Import Google Icon Font-->
<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> 
<!-- Compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
<!--Let browser know website is optimized for mobile-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
  
<script>
// Load the SDK asynchronously
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.5&appId=1121742734525327";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));

function goOnline(){
	$.post("http://localhost:3000/status", { uid: userId, tok: accessToken,status:'online' }).done(function(data, status){
			//use toasts here #fix
	        console.log("Data: " + data + "\nStatus: " + status);
		});
}
function goOffline(){
	$.post("http://localhost:3000/status", { uid: userId, tok: accessToken,status:'offline' }).done(function(data, status){
			//use toasts here #fix
	        console.log("Data: " + data + "\nStatus: " + status);
	});
}
</script>

<div class="row">
    <div class="col s4 m4">
      <div class="card red lighten-1">
        <div class="card-content white-text">
          <span class="card-title">Connect Facebook</span><br/>
			<div class="fb-login-button" data-max-rows="1" data-size="large" data-show-faces="true" data-auto-logout-link="true" data-scope="public_profile,email,user_friends" onlogin=""></div>
        </div>
        
        <div class="card-action">
          <a class="waves-effect green lighten-2 waves-light btn" onclick="goOnline()"><i class="material-icons small left">visibility</i>Go Online</a>
          <a class="waves-effect grey waves-light disabled btn" onclick="goOffline()"><i class="material-icons small left">visibility_off</i>Go Offline</a>
        </div>
        
      </div>
    </div>
    <div class="col s8 m8">
    	<div class="col s5 m5">
	      <div class="input-field col s6">
          <input placeholder="Type message here" id="message" type="text">
          </div>
	      <a class="btn-floating red"><i class="material-icons">send</i></a>
    	</div>
    </div>
</div>
            
<script>
  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    console.log(response);
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      accessToken = response.authResponse.accessToken;
       userId = response.authResponse.userID;
      testAPI();
    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into this app.';
    } else {
      // The person is not logged into Facebook, so we're not sure if
      // they are logged into this app or not.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into Facebook.';
    }
  }

  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
      console.log('Successful login for: ' + response.name);
      document.getElementById('status').innerHTML =
        'Thanks for logging in, ' + response.name + '!';
    });
  }

/*
The Login Dialog lets people decline to share certain permissions with your app that you ask for. Your app should handle this case. Learn more about this in our permissions dialog.
*/

</script>
</body>
<script src="/socket.io/socket.io.js"></script>
 <!--Import jQuery before materialize.js-->
 <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
 <!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
<script>
	function initChat(){
	  var socket = io();
	  $('form').submit(function(){
	    socket.emit('chat message', $('#m').val());
	    $('#m').val('');
	    return false;
	  });
	  socket.on('chat message', function(msg){
	    $('#messages').append($('<li>').text(msg));
	  });
	}
</script>
</html>